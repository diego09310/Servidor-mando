#!/bin/bash
# Script que lanza y comunica los scripts de reconocimiento de voz y traducción
# Parámetros: fichero, lenguaje (es-ES) origen y y destino rate
# La salida son dos ficheros, uno con la transcripción y otro con la traducción

audio=$1
language1=$2
language2=$3
rate=$4

# Reconocimiento de voz
echo transcribiendo el fichero de audio
./scripts/speech2text.sh $audio $language1 $rate

# Tratamiento de errores
check=`sed -n 1p transcription.txt`
if [ "$check" = "<HTML>" ]
then
	if [ "`grep "Error 400" transcription.txt`" -o "`grep "Error 500" transcription.txt`" ]
	then
		echo No se ha reconocido nada >translation.txt
	elif [ "`grep "Error 413" transcription.txt`" ]
	then
		echo El fichero es demasiado largo >translation.txt
	else
		echo Error desconocido >translation.txt
	fi
else
	# Traducción
	echo traduciendo...
	language1=`echo $language1 | sed -e 's/-.*//'`
	language2=`echo $language2 | sed -e 's/-.*//'`
	./scripts/translation.php transcription.txt $language1 $language2  
fi

rm $audio.flac 2>/dev/null
